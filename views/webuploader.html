<html>
<head>
	<!--引入CSS-->
	<link rel="stylesheet" type="text/css" href="stylesheets/webuploader.css">
	
	<!--引入JS-->
	<script type="text/javascript" src="javascripts/jquery.min.js"></script>		
	<script type="text/javascript" src="javascripts/webuploader.js"></script>		
</head>
<body>
	<div id="uploader" class="wu-example">
	    <!--用来存放文件信息-->
	    <div id="thelist" class="uploader-list"></div>
	    <div class="btns">
	        <div id="picker">选择文件</div>
	        <button id="ctlBtn" class="btn btn-default">开始上传</button>
	    </div>
	</div>
	<div name="image" id="dropbox" style="min-width:300px;min-height:100px;border:3px dashed silver;"></div>
</body>

<script>
		
       var $list = $('#thelist'),
        $btn = $('#ctlBtn'),
        state = 'pending',
        uploader;
	var uploader = WebUploader.create({
	    // swf文件路径
	    swf: '/js/Uploader.swf',
	    // 文件接收服务端。
	    server: '/uploader',
	    // 选择文件的按钮。可选。
	    // 内部根据当前运行是创建，可能是input元素，也可能是flash.
	    pick: '#picker',
	    // 不压缩image, 默认如果是jpeg，文件上传前会压缩一把再上传！
	    resize: false
	});

	uploader.on( 'fileQueued', function( file ) {
	    $list.append( '<div id="' + file.id + '" class="item">' +
	        '<h4 class="info">' + file.name + '</h4>' +
	        '<p class="state">等待上传...</p>' +
	    '</div>' );
	});

	$btn.on( 'click', function() {
        if ( state === 'uploading' ) {
            uploader.stop();
        } else {
            uploader.upload();
        }
    });

	// 文件上传过程中创建进度条实时显示。
	uploader.on( 'uploadProgress', function( file, percentage ) {
	    var $li = $( '#'+file.id ),
	        $percent = $li.find('.progress .progress-bar');

	    // 避免重复创建
	    if ( !$percent.length ) {
	        $percent = $('<div class="progress progress-striped active">' +
	          '<div class="progress-bar" role="progressbar" style="width: 0%">' +
	          '</div>' +
	        '</div>').appendTo( $li ).find('.progress-bar');
	    }

	    $li.find('p.state').text('上传中');

	    $percent.css( 'width', percentage * 100 + '%' );
	});







document.addEventListener("dragenter", function(e){  
    dropbox.style.borderColor = 'gray';  
}, false);  
document.addEventListener("dragleave", function(e){  
    dropbox.style.borderColor = 'silver';  
}, false);  
dropbox.addEventListener("dragenter", function(e){  
    dropbox.style.borderColor = 'gray';  
    dropbox.style.backgroundColor = 'white';  
}, false);  
dropbox.addEventListener("dragleave", function(e){  
    dropbox.style.backgroundColor = 'transparent';  
}, false);  
dropbox.addEventListener("dragenter", function(e){  
    e.stopPropagation();  
    e.preventDefault();  
}, false);  
dropbox.addEventListener("dragover", function(e){  
    e.stopPropagation();  
    e.preventDefault();  
}, false);  
dropbox.addEventListener("drop", function(e){  
    e.stopPropagation();  
    e.preventDefault();  
       
    handleFiles(e.dataTransfer.files);  
       
    
}, false);

handleFiles = function(files) {  
    for (var i = 0; i < files.length; i++) {  
        var file = files[i];  
   
    }  
} 



var xhr = new XMLHttpRequest();  
xhr.open('post', '/uploader', true);   

xhr.upload.addEventListener("progress", function(e) {  
    if (e.lengthComputable) {  
        var percentage = Math.round((e.loaded * 100) / e.total);  
        img.style.opacity = 1-percentage/100.0;  
    }  
}, false);  
   
xhr.upload.addEventListener("load", function(e){  
       
}, false); 

xhr.setRequestHeader("Content-Type", "multipart/form-data, boundary="+boundary); // simulate a file MIME POST request.  
xhr.setRequestHeader("Content-Length", fileSize);  
   
var body = '';  
body += "--" + boundary + "\r\n";  
body += "Content-Disposition: form-data; name=\""+dropbox.getAttribute('name')+"\"; filename=\"" + fileName + "\"\r\n";  
body += "Content-Type: "+fileType+"\r\n\r\n";  
body += fileData + "\r\n";  
body += "--" + boundary + "--\r\n";  
   
xhr.sendAsBinary(body);  
</script>
</html>


